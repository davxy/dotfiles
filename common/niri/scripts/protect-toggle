#!/bin/bash
# Toggle close-protection for the focused window.
# Protected window IDs are stored in /tmp/niri-protected-windows.

PROTECTED_FILE="/tmp/niri-protected-windows"
touch "$PROTECTED_FILE"

info=$(niri msg --json focused-window) || exit 1
id=$(jq -r '.id' <<< "$info")
title=$(jq -r '.title' <<< "$info")

if grep -qx "$id" "$PROTECTED_FILE"; then
    sed -i "/^${id}$/d" "$PROTECTED_FILE"
    notify-send -h string:x-canonical-private-synchronous:protect -u low "Window unprotected" "$title"
else
    echo "$id" >> "$PROTECTED_FILE"
    notify-send -h string:x-canonical-private-synchronous:protect -u low "Window protected" "$title"
fi
